<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Dashboard | Residence Finder</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Mapbox GL -->
    <link href="https://api.mapbox.com/mapbox-gl-js/v2.14.1/mapbox-gl.css" rel="stylesheet">
    <!-- Custom CSS -->
    <style>
        .student-dashboard {
            background-color: #f8f9fa;
        }
        .property-card {
            transition: transform 0.2s;
        }
        .property-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        .property-img {
            height: 200px;
            object-fit: cover;
        }
        .save-property .far {
            color: #dc3545;
        }
        .save-property .fas {
            display: none;
            color: #dc3545;
        }
        .save-property.active .far {
            display: none;
        }
        .save-property.active .fas {
            display: inline-block;
        }
        #mapViewBtn.active, #listViewBtn.active {
            background-color: #0d6efd;
            color: white;
        }
    </style>
</head>
<body class="student-dashboard">
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">
                <i class="fas fa-home me-2"></i>ResidenceFinder
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link active" href="#search-section"><i class="fas fa-search me-1"></i> Search</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#saved-section"><i class="fas fa-heart me-1"></i> Saved</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="management.html"><i class="fas fa-envelope me-1"></i> Messages</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#appointments-section"><i class="fas fa-calendar-alt me-1"></i> Appointments</a>
                    </li>
                </ul>
                <div class="d-flex align-items-center">
                    <div class="dropdown">
                        <a href="#" class="d-flex align-items-center text-white text-decoration-none dropdown-toggle" id="userDropdown" data-bs-toggle="dropdown">
                            <img src="holani.jpg" alt="Profile" width="32" height="32" class="rounded-circle me-2">
                            <span>Baloyi Holani</span>
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end">
                            <li><a class="dropdown-item" href="#profile-section"><i class="fas fa-user me-2"></i> Profile</a></li>
                            <li><a class="dropdown-item" href="#"><i class="fas fa-cog me-2"></i> Settings</a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item" href="index.html"><i class="fas fa-sign-out-alt me-2"></i> Logout</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container-fluid mt-4">
        <div class="row">
            <!-- Sidebar Filters -->
            <div class="col-lg-3 mb-4">
                <div class="card shadow-sm">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0"><i class="fas fa-filter me-2"></i>Search Filters</h5>
                    </div>
                    <div class="card-body">
                        <form id="searchFilters">
                            <!-- Location -->
                            <div class="mb-3">
                                <label class="form-label">Location</label>
                                <select class="form-select" id="location">
                                    <option selected>Anywhere</option>
                                    <option>Within 1km of campus</option>
                                    <option>Within 3km of campus</option>
                                    <option>Near public transport</option>
                                    <option>Braamfontein</option>
                                    <option>Hatfield</option>
                                    <option>Sunnyside</option>
                                </select>
                            </div>

                            <!-- Rent Range -->
                            <div class="mb-3">
                                <label class="form-label">Rent Range (ZAR)</label>
                                <div class="d-flex align-items-center">
                                    <input type="number" class="form-control" placeholder="Min" id="minRent" min="0" step="500">
                                    <span class="mx-2">to</span>
                                    <input type="number" class="form-control" placeholder="Max" id="maxRent" min="0" step="500">
                                </div>
                                <div id="rentRange" class="mt-2"></div>
                            </div>

                            <!-- Accommodation Type -->
                            <div class="mb-3">
                                <label class="form-label">Accommodation Type</label>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="privateRoom" checked>
                                    <label class="form-check-label" for="privateRoom">Private Room</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="sharedRoom" checked>
                                    <label class="form-check-label" for="sharedRoom">Shared Room</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="studio" checked>
                                    <label class="form-check-label" for="studio">Studio Apartment</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="sharedApartment" checked>
                                    <label class="form-check-label" for="sharedApartment">Shared Apartment</label>
                                </div>
                            </div>

                            <!-- Amenities -->
                            <div class="mb-3">
                                <label class="form-label">Amenities</label>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="wifi">
                                    <label class="form-check-label" for="wifi">Wi-Fi</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="parking">
                                    <label class="form-check-label" for="parking">Parking</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="laundry">
                                    <label class="form-check-label" for="laundry">Laundry</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="kitchen">
                                    <label class="form-check-label" for="kitchen">Kitchen</label>
                                </div>
                            </div>

                            <!-- Availability -->
                            <div class="mb-3">
                                <label class="form-label">Availability</label>
                                <div class="input-group mb-2">
                                    <span class="input-group-text">From</span>
                                    <input type="date" class="form-control" id="moveInDate">
                                </div>
                                <div class="input-group">
                                    <span class="input-group-text">To</span>
                                    <input type="date" class="form-control" id="moveOutDate">
                                </div>
                            </div>

                            <!-- Sort Options -->
                            <div class="mb-3">
                                <label class="form-label">Sort By</label>
                                <select class="form-select" id="sortBy">
                                    <option value="relevance">Relevance</option>
                                    <option value="price-asc">Price: Low to High</option>
                                    <option value="price-desc">Price: High to Low</option>
                                    <option value="distance">Distance to Campus</option>
                                    <option value="newest">Newest Listings</option>
                                </select>
                            </div>

                            <button type="submit" class="btn btn-primary w-100">
                                <i class="fas fa-search me-2"></i>Apply Filters
                            </button>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Main Content Area -->
            <div class="col-lg-9">
                <!-- Search Results Section -->
                <section id="search-section" class="mb-5">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h2><i class="fas fa-search me-2"></i>Available Residences</h2>
                        <div class="d-flex">
                            <button class="btn btn-outline-secondary me-2" id="mapViewBtn">
                                <i class="fas fa-map-marked-alt me-1"></i> Map View
                            </button>
                            <button class="btn btn-outline-secondary active" id="listViewBtn">
                                <i class="fas fa-list me-1"></i> List View
                            </button>
                        </div>
                    </div>

                    <!-- Map View (Hidden by default) -->
                    <div id="mapView" style="display: none; height: 500px;" class="mb-4 rounded-3 shadow-sm">
                        <div id="map" class="h-100 rounded-3"></div>
                    </div>

                    <!-- List View -->
                    <div id="listView">
                        <div class="row g-4" id="residencesContainer">
                            <!-- Residences will be loaded here dynamically -->
                            <div class="col-12 text-center py-5">
                                <div class="spinner-border text-primary" role="status">
                                    <span class="visually-hidden">Loading...</span>
                                </div>
                                <p class="mt-3">Loading residences...</p>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Saved Properties Section -->
                <section id="saved-section" class="mb-5">
                    <h2 class="mb-4"><i class="fas fa-heart me-2"></i>Saved Properties</h2>
                    <div class="alert alert-info">
                        You have 2 saved properties. <a href="#" class="alert-link">View all</a>
                    </div>
                    <div class="row g-4">
                        <!-- Saved Property 1 -->
                        <div class="col-md-6">
                            <div class="card h-100">
                                <div class="row g-0">
                                    <div class="col-md-4">
                                        <img src="https://images.unsplash.com/photo-1493809842364-78817add7ffb?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1470&q=80" class="img-fluid rounded-start h-100" alt="Saved Property" style="object-fit: cover;">
                                    </div>
                                    <div class="col-md-8">
                                        <div class="card-body">
                                            <div class="d-flex justify-content-between">
                                                <h5 class="card-title">Luxury Studio in Sandton</h5>
                                                <button class="btn btn-sm btn-outline-danger">
                                                    <i class="fas fa-trash"></i>
                                                </button>
                                            </div>
                                            <p class="card-text text-muted small">
                                                <i class="fas fa-map-marker-alt text-danger me-1"></i>
                                                3.5km from Wits University
                                            </p>
                                            <div class="d-flex justify-content-between align-items-center mt-3">
                                                <span class="text-primary fw-bold">R6,500/mo</span>
                                                <div>
                                                    <button class="btn btn-sm btn-primary me-2">
                                                        <i class="fas fa-envelope me-1"></i> Contact
                                                    </button>
                                                    <button class="btn btn-sm btn-outline-primary">
                                                        <i class="fas fa-calendar me-1"></i> Viewing
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- Saved Property 2 -->
                        <div class="col-md-6">
                            <div class="card h-100">
                                <div class="row g-0">
                                    <div class="col-md-4">
                                        <img src="https://images.unsplash.com/photo-1522708323590-d24dbb6b0267?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1470&q=80" class="img-fluid rounded-start h-100" alt="Saved Property" style="object-fit: cover;">
                                    </div>
                                    <div class="col-md-8">
                                        <div class="card-body">
                                            <div class="d-flex justify-content-between">
                                                <h5 class="card-title">Shared House in Melville</h5>
                                                <button class="btn btn-sm btn-outline-danger">
                                                    <i class="fas fa-trash"></i>
                                                </button>
                                            </div>
                                            <p class="card-text text-muted small">
                                                <i class="fas fa-map-marker-alt text-danger me-1"></i>
                                                2.1km from UJ Auckland Park
                                            </p>
                                            <div class="d-flex justify-content-between align-items-center mt-3">
                                                <span class="text-primary fw-bold">R4,200/mo</span>
                                                <div>
                                                    <button class="btn btn-sm btn-primary me-2">
                                                        <i class="fas fa-envelope me-1"></i> Contact
                                                    </button>
                                                    <button class="btn btn-sm btn-outline-primary">
                                                        <i class="fas fa-calendar me-1"></i> Viewing
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Messages Section -->
                <section id="messages-section" class="mb-5">
                    <h2 class="mb-4"><i class="fas fa-envelope me-2"></i>Messages</h2>
                    <div class="card">
                        <div class="card-header">
                            <ul class="nav nav-tabs card-header-tabs">
                                <li class="nav-item">
                                    <a class="nav-link active" href="#">Inbox (3)</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" href="#">Sent</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" href="#">Archived</a>
                                </li>
                            </ul>
                        </div>
                        <div class="card-body p-0">
                            <div class="list-group list-group-flush">
                                <!-- Message 1 -->
                                <a href="#" class="list-group-item list-group-item-action">
                                    <div class="d-flex w-100 justify-content-between">
                                        <div class="d-flex align-items-center">
                                            <img src="https://randomuser.me/api/portraits/men/32.jpg" width="40" height="40" class="rounded-circle me-3" alt="Landlord">
                                            <div>
                                                <h6 class="mb-0">Mr. Peterson</h6>
                                                <small class="text-muted">Braamfontein Studio</small>
                                            </div>
                                        </div>
                                        <div class="text-end">
                                            <small class="text-muted">Today, 10:30 AM</small>
                                            <span class="badge bg-primary rounded-pill ms-2">New</span>
                                        </div>
                                    </div>
                                    <p class="mb-0 mt-2">Hi Sarah, the studio is still available. Would you like to schedule a viewing?</p>
                                </a>
                                <!-- Message 2 -->
                                <a href="#" class="list-group-item list-group-item-action">
                                    <div class="d-flex w-100 justify-content-between">
                                        <div class="d-flex align-items-center">
                                            <img src="https://randomuser.me/api/portraits/women/45.jpg" width="40" height="40" class="rounded-circle me-3" alt="Landlord">
                                            <div>
                                                <h6 class="mb-0">Ms. Khumalo</h6>
                                                <small class="text-muted">Hatfield Shared Apartment</small>
                                            </div>
                                        </div>
                                        <div class="text-end">
                                            <small class="text-muted">Yesterday, 4:15 PM</small>
                                        </div>
                                    </div>
                                    <p class="mb-0 mt-2">I've attached the lease agreement for your review.</p>
                                </a>
                                <!-- Message 3 -->
                                <a href="#" class="list-group-item list-group-item-action">
                                    <div class="d-flex w-100 justify-content-between">
                                        <div class="d-flex align-items-center">
                                            <img src="https://randomuser.me/api/portraits/men/68.jpg" width="40" height="40" class="rounded-circle me-3" alt="Landlord">
                                            <div>
                                                <h6 class="mb-0">Dr. Van der Merwe</h6>
                                                <small class="text-muted">Sunnyside Private Room</small>
                                            </div>
                                        </div>
                                        <div class="text-end">
                                            <small class="text-muted">Monday, 9:20 AM</small>
                                        </div>
                                    </div>
                                    <p class="mb-0 mt-2">The room will be available from next month as discussed.</p>
                                </a>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Appointments Section -->
                <section id="appointments-section" class="mb-5">
                    <h2 class="mb-4"><i class="fas fa-calendar-alt me-2"></i>Viewing Appointments</h2>
                    <div class="card">
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead>
                                        <tr>
                                            <th>Property</th>
                                            <th>Date & Time</th>
                                            <th>Location</th>
                                            <th>Status</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>
                                                <div class="d-flex align-items-center">
                                                    <img src="https://images.unsplash.com/photo-1560448204-e02f11c3d0e2?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1470&q=80" width="50" height="50" class="rounded me-3" style="object-fit: cover;">
                                                    <div>
                                                        <h6 class="mb-0">Braamfontein Studio</h6>
                                                        <small class="text-muted">Mr. Peterson</small>
                                                    </div>
                                                </div>
                                            </td>
                                            <td>Fri, 15 Sep 2025<br>2:00 PM</td>
                                            <td>24 Juta St, Braamfontein</td>
                                            <td><span class="badge bg-success">Confirmed</span></td>
                                            <td>
                                                <button class="btn btn-sm btn-outline-primary me-2">Details</button>
                                                <button class="btn btn-sm btn-outline-danger">Cancel</button>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>
                                                <div class="d-flex align-items-center">
                                                    <img src="https://images.unsplash.com/photo-1554469384-e58fac16e23a?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1374&q=80" width="50" height="50" class="rounded me-3" style="object-fit: cover;">
                                                    <div>
                                                        <h6 class="mb-0">Sunnyside Private Room</h6>
                                                        <small class="text-muted">Dr. Van der Merwe</small>
                                                    </div>
                                                </div>
                                            </td>
                                            <td>Mon, 18 Sep 2023<br>10:30 AM</td>
                                            <td>12 Sunnyside Ave, Pretoria</td>
                                            <td><span class="badge bg-warning text-dark">Pending</span></td>
                                            <td>
                                                <button class="btn btn-sm btn-outline-primary me-2">Details</button>
                                                <button class="btn btn-sm btn-outline-danger">Cancel</button>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Profile Section -->
                <section id="profile-section">
                    <h2 class="mb-4"><i class="fas fa-user me-2"></i>My Profile</h2>
                    <div class="row">
                        <div class="col-lg-4 mb-4">
                            <div class="card">
                                <div class="card-body text-center">
                                    <img src="holani.jpg" class="rounded-circle mb-3" width="120" height="120" alt="Profile">
                                    <h4>Holani Baloyi</h4>
                                    <p class="text-muted">University of Johannesburg</p>
                                    <button class="btn btn-outline-primary btn-sm">Edit Profile</button>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-8">
                            <div class="card">
                                <div class="card-body">
                                    <h5 class="card-title mb-4">Personal Information</h5>
                                    <div class="row g-3">
                                        <div class="col-md-6">
                                            <label class="form-label">Full Name</label>
                                            <input type="text" class="form-control" value="Baloyi Holani" disabled>
                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label">Student Number</label>
                                            <input type="text" class="form-control" value="20234567" disabled>
                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label">Email</label>
                                            <input type="email" class="form-control" value="holani@student.uj.ac.za" disabled>
                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label">Phone</label>
                                            <input type="tel" class="form-control" value="+27 76 123 4567">
                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label">University</label>
                                            <select class="form-select">
                                                <option>University of Johannesburg</option>
                                                <option>University of Pretoria</option>
                                                <option>Tshwane University of Technology</option>
                                            </select>
                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label">Campus</label>
                                            <input type="text" class="form-control" value="Auckland Park Kingsway">
                                        </div>
                                        <div class="col-12">
                                            <label class="form-label">Preferred Accommodation</label>
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" id="prefPrivate" checked>
                                                <label class="form-check-label" for="prefPrivate">Private Room</label>
                                            </div>
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" id="prefShared" checked>
                                                <label class="form-check-label" for="prefShared">Shared Room</label>
                                            </div>
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" id="prefStudio">
                                                <label class="form-check-label" for="prefStudio">Studio Apartment</label>
                                            </div>
                                        </div>
                                        <div class="col-12">
                                            <label class="form-label">Maximum Budget (ZAR)</label>
                                            <input type="range" class="form-range" min="2000" max="10000" step="500" value="6000" id="budgetRange">
                                            <div class="d-flex justify-content-between">
                                                <small>R2,000</small>
                                                <small>R6,000</small>
                                                <small>R10,000</small>
                                            </div>
                                        </div>
                                        <div class="col-12 mt-4">
                                            <button class="btn btn-primary">Save Changes</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Mapbox GL JS -->
    <script src="https://api.mapbox.com/mapbox-gl-js/v2.14.1/mapbox-gl.js"></script>
    <!-- Custom JS -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // View toggle functionality
            const mapViewBtn = document.getElementById('mapViewBtn');
            const listViewBtn = document.getElementById('listViewBtn');
            const mapView = document.getElementById('mapView');
            const listView = document.getElementById('listView');

            mapViewBtn.addEventListener('click', function() {
                mapView.style.display = 'block';
                listView.style.display = 'none';
                mapViewBtn.classList.add('active');
                listViewBtn.classList.remove('active');
                initMap();
            });

            listViewBtn.addEventListener('click', function() {
                mapView.style.display = 'none';
                listView.style.display = 'block';
                listViewBtn.classList.add('active');
                mapViewBtn.classList.remove('active');
            });

            // Save property functionality
            document.addEventListener('click', function(e) {
                if (e.target.closest('.save-property')) {
                    const btn = e.target.closest('.save-property');
                    btn.classList.toggle('active');
                }
            });

            // Fetch residences from backend
            fetchResidences();

            async function fetchResidences() {
                try {
                    const response = await fetch('http://localhost:3000/api/residences');
                    if (!response.ok) {
                        throw new Error('Failed to fetch residences');
                    }
                    const residences = await response.json();
                    displayResidences(residences);
                } catch (error) {
                    console.error('Error fetching residences:', error);
                    const container = document.getElementById('residencesContainer');
                    container.innerHTML = `
                        <div class="col-12 text-center py-5">
                            <i class="fas fa-exclamation-triangle fa-2x text-danger mb-3"></i>
                            <p>Failed to load residences. Please try again later.</p>
                            <button class="btn btn-primary" onclick="fetchResidences()">Retry</button>
                        </div>
                    `;
                }
            }

            function displayResidences(residences) {
                const container = document.getElementById('residencesContainer');
                container.innerHTML = '';

                if (residences.length === 0) {
                    container.innerHTML = `
                        <div class="col-12 text-center py-5">
                            <i class="fas fa-home fa-2x text-muted mb-3"></i>
                            <p>No residences found matching your criteria.</p>
                        </div>
                    `;
                    return;
                }

                residences.forEach(residence => {
                    const card = createResidenceCard(residence);
                    container.appendChild(card);
                });
            }

            function createResidenceCard(residence) {
                const col = document.createElement('div');
                col.className = 'col-md-6 col-lg-4';

                // Format amenities badges
                const amenities = [];
                if (residence.hasWifi) amenities.push('<span class="badge bg-light text-dark"><i class="fas fa-wifi me-1"></i> Wi-Fi</span>');
                if (residence.hasParking) amenities.push('<span class="badge bg-light text-dark"><i class="fas fa-car me-1"></i> Parking</span>');
                amenities.push(`<span class="badge bg-light text-dark"><i class="fas fa-bed me-1"></i> ${residence.beds} Bed${residence.beds > 1 ? 's' : ''}</span>`);
                amenities.push(`<span class="badge bg-light text-dark"><i class="fas fa-bath me-1"></i> ${residence.bathrooms} Bath${residence.bathrooms > 1 ? 's' : ''}</span>`);

                // Determine availability badge
                let availabilityBadge = '';
                if (residence.available) {
                    availabilityBadge = '<div class="badge bg-success position-absolute top-0 end-0 m-2">Available</div>';
                } else {
                    availabilityBadge = '<div class="badge bg-secondary position-absolute top-0 end-0 m-2">Unavailable</div>';
                }

                col.innerHTML = `
                    <div class="card property-card h-100">
                        ${availabilityBadge}
                        <img src="${residence.images && residence.images.length > 0 ? residence.images[0] : 'https://images.unsplash.com/photo-1560448204-e02f11c3d0e2?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1470&q=80'}" 
                             class="card-img-top property-img" alt="${residence.name}">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-start mb-2">
                                <h5 class="card-title mb-0">${residence.name}</h5>
                                <button class="btn btn-sm btn-outline-secondary save-property">
                                    <i class="far fa-heart"></i>
                                    <i class="fas fa-heart"></i>
                                </button>
                            </div>
                            <p class="card-text text-muted small">
                                <i class="fas fa-map-marker-alt text-danger me-1"></i>
                                ${residence.location}
                            </p>
                            <div class="property-features d-flex flex-wrap gap-2 mb-3">
                                ${amenities.join('')}
                            </div>
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <span class="text-primary fw-bold">R${residence.monthlyRate.toLocaleString()}</span>/mo
                                </div>
                                <a href="property-details.html?id=${residence.id}" class="btn btn-sm btn-outline-primary">View Details</a>
                            </div>
                        </div>
                    </div>
                `;
                return col;
            }

            // Initialize map (will be called when map view is activated)
            function initMap() {
                mapboxgl.accessToken = 'YOUR_MAPBOX_ACCESS_TOKEN';
                const map = new mapboxgl.Map({
                    container: 'map',
                    style: 'mapbox://styles/mapbox/streets-v11',
                    center: [28.0456, -26.2041], // Johannesburg coordinates
                    zoom: 12
                });

                // Add navigation controls
                map.addControl(new mapboxgl.NavigationControl());

                // TODO: Add residence markers to the map
                // You would fetch residences again or use the already loaded data
                // to add markers to the map
            }
        });
    </script>
</body>
</html>